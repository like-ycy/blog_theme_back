---
title:      " 运维面试题系列--shell脚本问题 "
date:       2021-03-03
banner_img: "https://gitee.com/like-ycy/images/raw/master/blog/header.jpg"
tags: [ 面试 ]
---

# shell脚本



## 理论部分

### 1、在当前脚本中调用另一个脚本

- exec（exec /home/script.sh）：
  使用exec来调用脚本，被执行的脚本会继承当前shell的环境变量。但事实上exec产生了新的进程，他会把主shell的进程资源占用并替换脚本内容，继承了原主shell的PID号，即原主shell剩下的内容不会执行。

- source（source /home/script.sh）
  使用source或者“.”来调用外部脚本，不会产生新的进程，继承当前shell环境变量，而且被调用的脚本运行结束后，它拥有的环境变量和声明变量会被当前shell保留，类似将调用脚本的内容复制过来直接执行。执行完毕后原主shell继续运行。

- fork（/home/script.sh）
  直接运行脚本，会以当前shell为父进程，产生新的进程，并且继承主脚本的环境变量和声明变量。执行完毕后，主脚本不会保留其环境变量和声明变量。

### 2、shell中的特殊变量

| 变量 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| $0   | 当前脚本的文件名                                             |
| $n   | 传递给脚本或函数的参数。n 是一个数字，表示第几个参数。例如，第一个参数是$1，第二个参数是$2。 |
| $#   | 传递给脚本或函数的参数个数。                                 |
| $*   | 传递给脚本或函数的所有参数。                                 |
| $@   | 传递给脚本或函数的所有参数。被双引号(" ")包含时，与 $* 稍有不同，下面将会讲到。 |
| $?   | 上个命令的退出状态，或函数的返回值。                         |
| $$   | 当前Shell进程ID。对于 Shell 脚本，就是这些脚本所在的进程ID。 |

> #### $* 和 $@ 的区别
>
> $* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号(" ")包含时，都以"$1" "$2" … "$n" 的形式输出所有参数。
>
> 但是当它们被双引号(" ")包含时，"$*" 会将所有的参数作为一个整体，以"$1 $2 … $n"的形式输出所有参数；"$@" 会将各个参数分开，以"$1" "$2" … "$n" 的形式输出所有参数。



## 实战部分

### 1、统计日志文件中访问时间超过50s

```bash
awk '$2 >= 10 {print $2}' yum.log | sort -nr | wc -l
```

### 2、**编写个shell脚本将当前目录下大于10K的文件转移到/tmp目录下** 

```shell
#!/bin/bash
for FileName in `ls l | awk '$5>10240 {print $9}'`;do mv $FileName /tmp;done 
```

### 3、使用shell，建立classl用户组，再批量建立stu 1--stu30的用户，并指定用户组为classl

```SHELL
#!/bin/bash
groupadd class1
for((i=1;i<=30;i=i+1))
do
useradd stu$i -G class1  
done
```

